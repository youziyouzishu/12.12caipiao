import{z as e,K as l,p as a,o as s,c as t,w as u,i as n,r as o,e as d,a as i,h as m,g as c,b as f,F as _,m as r,t as b,D as p,l as v,P as y,X as h,R as g,Q as k,Y as V,Z as C,_ as x,a0 as j,a1 as w}from"./index-Dmu3mr1_.js";import{_ as F}from"./uv-code.DyexNmvp.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./mixin.qHq9NBSw.js";function M(e){if(11!==(e=String(e)).length)throw new Error("手机号格式不正确!");return e.substring(0,3)+"****"+e.substring(7)}const S=U({__name:"bindMobileForm",setup(U){const S=e();l();const R=a(1),q=a(60),z=a(""),D=a(),E=e=>{z.value=e},G=async()=>{if(D.value.canGetCode){h({title:"正在获取验证码"});try{const e={1:"checkmobile",3:"changemobile"},l={mobile:S.userinfo.mobile,event:e[R.value]};3==R.value&&(l.mobile=Q.value);const a=await g(l);console.log("sendSms ",a),k("验证码已发送"),D.value.start()}catch(e){}finally{V()}}else k("倒计时结束后再发送")},I=a(""),K=(e=1)=>{j({url:"/pages_common/pages/bindMobileForm/bindMobileForm?step="+e},!1)},P=a(""),Q=a(""),T=()=>{P.value===S.userinfo.mobile?K(3):k("手机号输入不正确!")},X=async()=>{if(Q.value)if(I.value)try{Q.value,I.value;k("绑定成功"),setTimeout((()=>{w({delta:2})}),1e3)}catch(e){}else k("请输入验证码");else k("请输入手机号")};return s((e=>{e.step&&(R.value=e.step)})),(e,l)=>{const a=n,s=v,h=y,g=o(d("uv-code"),F);return i(),t(a,{class:"bind-mobile-container"},{default:u((()=>[1==R.value?(i(),m(_,{key:0},[f(a,{class:"bind-tip"},{default:u((()=>[r(" 请在5分钟内输入"+b(p(M)(p(S).userinfo.mobile))+"收到的验证码 ",1)])),_:1}),f(a,{class:"bind-form"},{default:u((()=>[f(a,{class:"bind-form-item"},{default:u((()=>[f(a,{class:"bind-form-item__label"},{default:u((()=>[f(s,null,{default:u((()=>[r("验证码")])),_:1})])),_:1}),f(a,{class:"bind-form-item__content"},{default:u((()=>[f(h,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),type:"number",placeholder:"请输入验证码"},null,8,["modelValue"])])),_:1}),f(a,{class:"bind-form-item__sms",onClick:G},{default:u((()=>[f(s,null,{default:u((()=>[r(b(z.value),1)])),_:1})])),_:1})])),_:1}),f(a,{class:"submit-btn",onClick:l[1]||(l[1]=e=>(async()=>{if(I.value){S.userinfo.mobile,I.value,console.log("校验旧手机");try{C("校验中"),K(3)}catch(e){}finally{x()}}else k("请输入验证码")})())},{default:u((()=>[f(s,null,{default:u((()=>[r("下一步")])),_:1})])),_:1}),f(a,{class:"mobile-stop-text",onClick:l[3]||(l[3]=e=>K(2))},{default:u((()=>[f(s,{onClick:l[2]||(l[2]=e=>R.value=2)},{default:u((()=>[r("手机号停用")])),_:1})])),_:1})])),_:1})],64)):c("",!0),2==R.value?(i(),m(_,{key:1},[f(a,{class:"bind-tip"},{default:u((()=>[r(" 提示："+b(p(M)(p(S).userinfo.mobile)),1)])),_:1}),f(a,{class:"bind-form"},{default:u((()=>[f(a,{class:"bind-form-item"},{default:u((()=>[f(a,{class:"bind-form-item__label"},{default:u((()=>[f(s,null,{default:u((()=>[r("手机号")])),_:1})])),_:1}),f(a,{class:"bind-form-item__content"},{default:u((()=>[f(h,{modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e),type:"number",placeholder:"请输入完整手机号"},null,8,["modelValue"])])),_:1})])),_:1}),f(a,{class:"submit-btn",onClick:T},{default:u((()=>[f(s,null,{default:u((()=>[r("下一步")])),_:1})])),_:1})])),_:1})],64)):c("",!0),3==R.value?(i(),m(_,{key:2},[f(a,{class:"bind-tip"},{default:u((()=>[r(" 验证成功，请在下方输入新的手机号并填写验证码 ")])),_:1}),f(a,{class:"bind-form"},{default:u((()=>[f(a,{class:"bind-form-item"},{default:u((()=>[f(a,{class:"bind-form-item__label"},{default:u((()=>[f(s,null,{default:u((()=>[r("手机号")])),_:1})])),_:1}),f(a,{class:"bind-form-item__content"},{default:u((()=>[f(h,{modelValue:Q.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Q.value=e),type:"number",placeholder:"请输入完整手机号"},null,8,["modelValue"])])),_:1})])),_:1}),f(a,{class:"bind-form-item"},{default:u((()=>[f(a,{class:"bind-form-item__label"},{default:u((()=>[f(s,null,{default:u((()=>[r("验证码")])),_:1})])),_:1}),f(a,{class:"bind-form-item__content"},{default:u((()=>[f(h,{modelValue:I.value,"onUpdate:modelValue":l[6]||(l[6]=e=>I.value=e),type:"number",placeholder:"请输入验证码"},null,8,["modelValue"])])),_:1}),f(a,{class:"bind-form-item__sms",onClick:G},{default:u((()=>[f(s,null,{default:u((()=>[r(b(z.value),1)])),_:1})])),_:1})])),_:1}),f(a,{class:"account-security-setbind-tip"},{default:u((()=>[f(a,{class:""},{default:u((()=>[f(s,null,{default:u((()=>[r("注：")])),_:1})])),_:1}),f(a,null,{default:u((()=>[f(a,{class:"mt-20"},{default:u((()=>[r("1.无法解绑手机号；手机号一旦换绑，则所关联的实名认证手机号、提现手机号将同步更换为新手机号。")])),_:1}),f(a,{class:"mt-20"},{default:u((()=>[r("2.若您的帐号使用手机号登录，换绑后，将使用新号码作为登录手机号。")])),_:1})])),_:1})])),_:1}),f(a,{class:"submit-btn",onClick:X},{default:u((()=>[f(s,null,{default:u((()=>[r("提交")])),_:1})])),_:1})])),_:1})],64)):c("",!0),f(g,{"unique-key":"bind-mobile-form-page-code1",seconds:q.value,ref_key:"code",ref:D,onChange:E},null,8,["seconds"])])),_:1})}}},[["__scopeId","data-v-ca2f4c3b"]]);export{S as default};
