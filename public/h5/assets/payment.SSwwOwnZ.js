import{z as e,A as a,p as s,q as c,u as o,r as t,e as l,c as i,a as n,w as p,b as r,i as u,m,t as y,g as d,d as f,l as _,D as g,Z as x,_ as v,Q as w,b0 as k}from"./index-Dmu3mr1_.js";import{_ as h}from"./uv-popup.-CA74lk7.js";import{_ as b}from"./icon_radio_check.ClKEc5B7.js";import{_ as S}from"./icon_radio3.CadTa7NB.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=j({__name:"c-pay-popup",props:{isMoney:{type:Boolean,default:!0},payType:{type:String,default:"wxpay"},price:{type:[String,Number],default:0},isOrder:{type:Boolean,default:!1}},emits:["confirm","update:payType"],setup(x,{expose:v,emit:w}){const k=e(),{userinfo:j}=a(k),P=x,T=s(),A=s("wxpay");s(!1);const C=s(!1),I=w,z=()=>{T.value.close()},J=e=>{A.value=e,console.log("payType.value",A.value),I("update:payType",A.value)};return v({open:()=>{T.value.open()},close:z}),c((()=>{A.value=P.payType,o.getItem("config"),C.value=!0,C.value||J("money")})),(e,a)=>{const s=u,c=f,o=_,x=t(l("uv-popup"),h);return n(),i(s,null,{default:p((()=>[r(x,{ref_key:"popup",ref:T,mode:"bottom",round:"20rpx",closeable:""},{default:p((()=>[r(s,{class:"game-card-popup flex px-32 py-40 flex-column relative"},{default:p((()=>[r(s,{class:"popup-content"},{default:p((()=>[r(s,{class:"center pay-amount"},{default:p((()=>[m(" ￥"+y(P.price),1)])),_:1}),r(s,{class:"mt-40 pay-box"},{default:p((()=>[r(s,{class:"pay-item flex items-center",onClick:a[0]||(a[0]=e=>J("wxpay"))},{default:p((()=>[r(s,{class:"flex-1 flex items-center"},{default:p((()=>[r(c,{class:"pay-image",src:"/h5/static/images/wx_pay.png",mode:"widthFix"}),r(o,{class:"ml-20"},{default:p((()=>[m("微信支付")])),_:1})])),_:1}),r(s,{class:"pay-icon-box"},{default:p((()=>["wxpay"===A.value?(n(),i(c,{key:0,class:"icon",src:b,mode:""})):(n(),i(c,{key:1,class:"icon",src:S,mode:""}))])),_:1})])),_:1}),C.value?(n(),i(s,{key:0,class:"pay-item flex items-center mt-20",onClick:a[1]||(a[1]=e=>J("sz"))},{default:p((()=>[r(s,{class:"flex-1 flex items-center"},{default:p((()=>[r(c,{class:"pay-image",src:"/h5/static/images/sz_pay.png",mode:""}),r(s,{class:"ml-20"},{default:p((()=>[r(s,{class:""},{default:p((()=>[m("数字人民币支付")])),_:1})])),_:1})])),_:1}),r(s,{class:"pay-icon-box"},{default:p((()=>["sz"===A.value?(n(),i(c,{key:0,class:"icon",src:b,mode:""})):(n(),i(c,{key:1,class:"icon",src:S,mode:""}))])),_:1})])),_:1})):d("",!0),r(s,{class:"pay-item flex items-center mt-20",onClick:a[2]||(a[2]=e=>J("alipay"))},{default:p((()=>[r(s,{class:"flex-1 flex items-center"},{default:p((()=>[r(c,{class:"pay-image",src:"/h5/static/images/ali_pay.png",mode:""}),r(s,{class:"ml-20"},{default:p((()=>[r(s,{class:""},{default:p((()=>[m("支付宝支付")])),_:1})])),_:1})])),_:1}),r(s,{class:"pay-icon-box"},{default:p((()=>["alipay"===A.value?(n(),i(c,{key:0,class:"icon",src:b,mode:""})):(n(),i(c,{key:1,class:"icon",src:S,mode:""}))])),_:1})])),_:1}),P.isMoney?(n(),i(s,{key:1,class:"pay-item flex items-center mt-20",onClick:a[3]||(a[3]=e=>J("money"))},{default:p((()=>[r(s,{class:"flex-1 flex items-center"},{default:p((()=>[r(c,{class:"pay-image",src:"/h5/static/images/money_pay.png",mode:""}),r(s,{class:"ml-20"},{default:p((()=>[r(s,{class:""},{default:p((()=>[m("余额（"+y(g(j).money||0)+"）",1)])),_:1})])),_:1})])),_:1}),r(s,{class:"pay-icon-box"},{default:p((()=>["money"===A.value?(n(),i(c,{key:0,class:"icon",src:b,mode:""})):(n(),i(c,{key:1,class:"icon",src:S,mode:""}))])),_:1})])),_:1})):d("",!0)])),_:1})])),_:1}),r(s,{class:"popup-btn btn-bg-color center",onClick:a[4]||(a[4]=e=>(I("confirm",{type:A.value}),void z()))},{default:p((()=>[m(" 立即支付 ")])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-22241353"]]);function T(e,a){return{msg:e,data:a}}const A="wxpay",C="alipay",I="wechat",z="alipay",J="apply",M="wechat",W="wechat_mini",q="wechat_h5",L="wechat_h5_out";function N(){let e;return e=!navigator||navigator&&!navigator.userAgent||"micromessenger"!=navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?L:q,e}const O=async(e={})=>{let a;x("支付中...");try{a=await X(e),v()}catch(s){console.log("doPayment",s),w("支付失败")}return a},X=async e=>{const{payType:a,payInfo:s}=e;let c;if(a===I)switch(console.log("微信支付"),N()){case M:case W:c=await B(s);break;case q:c=await D(s);break;case L:console.error("暂不支持微信外h5支付");break;default:console.error("未知的支付类型")}else a===z?(console.log("支付宝支付"),c=await F(s)):a===J&&console.log("苹果支付");return c},B=e=>new Promise(((a,s)=>{k({service:"payment",success:function(c){console.log("res.provider",c.provider),c.provider.includes("wxpay")?uni.requestPayment({provider:A,...e,success:e=>a(T("用户支付成功",e)),fail:e=>s(T(JSON.stringify(e),e))}):s(T("暂不支持微信支付",{}))},fail:function(e){s(T("暂不支持微信支付",e))}})})),D=e=>new Promise(((a,s)=>{const c={debug:!1,appId:e.appId,timestamp:e.timeStamp,nonceStr:e.nonceStr,signature:e.paySign,jsApiList:["chooseWXPay"]};jweixin.config(c),jweixin.ready((()=>{jweixin.checkJsApi({jsApiList:["chooseWXPay"],success:()=>{},fail:e=>s(T("微信版本过低，请升级微信版本",e))}),jweixin.chooseWXPay({timestamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:e=>a(T("用户支付成功",e)),cancel:e=>(w("用户取消支付"),s(T("用户取消支付",{}))),fail:e=>(w("跳转微信支付失败"),s(T("跳转微信支付失败",e)))})})),jweixin.error((e=>s(T("JS-SDK加载错误",e))))})),F=e=>new Promise(((a,s)=>{k({service:"payment",success:function(c){console.log("res.provider",c.provider),c.provider.includes("alipay")?uni.requestPayment({provider:C,orderInfo:e,success:e=>a(T("用户支付成功",e)),fail:e=>s(T(JSON.stringify(e),e))}):s(T("暂不支持支付宝支付",{}))},fail:function(e){s(T("暂不支持支付宝支付",e))}})}));export{P as _,O as d};
