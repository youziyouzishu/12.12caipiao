import{z as e,A as a,p as o,r,e as t,c as s,a as l,w as n,b as i,g as d,i as c,D as u,l as p,m as y,E as f,n as m,O as v,Z as _,_ as g,a0 as h,bh as b,T as w,bi as k,bj as C}from"./index-Dmu3mr1_.js";import{_ as R}from"./uv-modal.C8ueCcq2.js";import{_ as I,d as S}from"./payment.SSwwOwnZ.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=j({__name:"order-operation",props:{status:{type:[Number,String],default:0},fixed:{type:Boolean,default:!1},orderNo:{type:[String],default:""},order:{type:Object,default:{}},reasonList:{type:Array,default:[]},customStyle:{type:[Object,String],default:""}},setup(j){const x=e(),{isEmployee:N}=a(x),O=j,{status:A,fixed:B,orderNo:T,order:U,reasonList:q}=a(O),z=o(),E=async e=>{const a={wxpay:1,alipay:2,sz:3,money:4};console.log("handlePayConfirm e",e,a[e.type]);const o={pay_type:a[e.type],ordersn:U.value.ordersn};console.log("支付参数",o);const r=await b(o);4==o.pay_type?(x.getUserInfo(),w("orderRefresh")):2==o.pay_type?(console.log("支付参数",r),await S({payType:"alipay",payInfo:r}),console.log("支付完成"),x.getUserInfo(),w("orderRefresh")):1==o.pay_type&&(await S({payType:"wechat",payInfo:{orderInfo:r}}),console.log("支付完成"),x.getUserInfo(),w("orderRefresh"))},F=o(""),L=o(),P=o(""),D=o(!0);o(),o("");const Z=()=>{console.log("modalConfirm",P.value),"del"===P.value?K():"over"===P.value?Q():"ret"===P.value?(console.log("申请退款"),J()):"cancel"===P.value?H():"retSq"===P.value?M():"get"===P.value&&(console.log("接单"),G())},G=async()=>{try{_(""),await peiTakeOrder({order_id:U.value.id}),w("orderRefresh")}catch(e){console.log("1")}finally{g()}},H=async()=>{await C({id:U.value.id}),w("orderRefresh")},J=async()=>{try{_(""),await submitRefund({order_id:U.value.id,reason:reason.value}),w("orderRefresh")}catch(e){console.log("1")}finally{g()}},K=async()=>{console.log("删除订单"),w("orderRefresh")},M=async()=>{console.log("撤销申请");try{_(""),await submitAftersaleCancel({order_id:U.value.id}),w("orderRefresh")}catch(e){}finally{g()}},Q=async()=>{console.log("完成订单");try{await k({id:U.value.id}),w("orderRefresh")}catch(e){}},V={1:{tip:"确认取消该订单吗?",type:"cancel"},2:{tip:"确认退款吗?",type:"ret"},3:{tip:"您已完成催单，您的订单已向前排名请您等待师傅与您联系",type:"remind"},4:{tip:"确认删除该订单吗?",type:"del"},5:{tip:"确认撤销申请吗?",type:"retSq"},6:{tip:"确定完成订单吗?",type:"over"},7:{tip:"确定接单吗?",type:"get"}},W=async(e,a=!0)=>{F.value="",P.value="";const{tip:o,type:r}=V[e];if(F.value=o,P.value=r,D.value=a,"remind"===P.value&&!U.value.remind){_("催单中");try{await remindOrder({order_id:U.value.id})}catch(t){}finally{g()}}L.value.open()};return(e,a)=>{const o=p,_=c,g=r(t("uv-modal"),R),b=r(t("c-pay-popup"),I);return l(),s(_,{class:v(["order-actions",u(B)&&"order-actions--fixed"]),style:m(j.customStyle),onClick:a[5]||(a[5]=f((()=>{}),["stop"]))},{default:n((()=>[i(_,{class:"order-actions-btns"},{default:n((()=>[[0,"0"].includes(Number(u(U).status))?(l(),s(_,{key:0,class:"order-actions-btn order-actions-default",onClick:a[0]||(a[0]=e=>W(1))},{default:n((()=>[i(o,null,{default:n((()=>[y("取消订单")])),_:1})])),_:1})):d("",!0),[0,"0"].includes(Number(u(U).status))?(l(),s(_,{key:1,class:"order-actions-btn order-actions-primary",onClick:a[1]||(a[1]=e=>{z.value.open()})},{default:n((()=>[i(o,null,{default:n((()=>[y("立即支付")])),_:1})])),_:1})):d("",!0),["3",3].includes(Number(u(U).status))?(l(),s(_,{key:2,class:"order-actions-btn order-actions-primary",onClick:a[2]||(a[2]=e=>W(6))},{default:n((()=>[i(o,null,{default:n((()=>[y("确认收货")])),_:1})])),_:1})):d("",!0),([4,"4"].includes(Number(u(U).status)),d("",!0)),[5,"5"].includes(u(U).status)?(l(),s(_,{key:4,class:"order-actions-btn order-actions-primary",onClick:a[4]||(a[4]=e=>{h({url:"/pages_shop/pages/order-comments/order-comments?orderId="+U.value.id})})},{default:n((()=>[i(o,null,{default:n((()=>[y("评价")])),_:1})])),_:1})):d("",!0)])),_:1}),i(g,{ref_key:"modal",ref:L,content:F.value,onConfirm:Z,showCancelButton:D.value,confirmColor:"#FF3B4A",align:"center"},null,8,["content","showCancelButton"]),u(U).id?(l(),s(b,{key:0,ref_key:"payPopup",ref:z,price:u(U).pay_amount,onConfirm:E},null,8,["price"])):d("",!0)])),_:1},8,["class","style"])}}},[["__scopeId","data-v-136f7485"]]);export{x as _};
