var e,a;import{c as t,a as l,w as o,b as s,g as n,bA as r,n as u,l as i,m as d,t as c,O as p,i as m,z as f,A as g,p as y,aE as h,o as v,u as b,aj as _,bp as x,x as S,bw as A,r as C,e as k,d as F,h as B,F as E,j,D as V,E as w,$ as I,Q as H,bh as Q,bB as N,bC as P}from"./index-Dmu3mr1_.js";import{_ as q}from"./uv-navbar.CCP2bw2Z.js";import{_ as D}from"./uv-icon.zJBDCHES.js";import{m as U,a as z}from"./mixin.qHq9NBSw.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as Y,d as $}from"./payment.SSwwOwnZ.js";import{_ as K,a as G}from"./icon_radio.BNSrvjyW.js";import"./uv-status-bar.C2pO0b0Y.js";import"./uv-popup.-CA74lk7.js";import"./uv-overlay.CooXhWSs.js";import"./icon_radio_check.ClKEc5B7.js";import"./icon_radio3.CadTa7NB.js";const L=T({name:"uv-textarea",mixins:[U,z,{props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},placeholder:{type:[String,Number],default:""},placeholderClass:{type:String,default:"textarea-placeholder"},placeholderStyle:{type:[String,Object],default:"color: #c0c4cc"},height:{type:[String,Number],default:70},confirmType:{type:String,default:"return"},disabled:{type:Boolean,default:!1},count:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},autoHeight:{type:Boolean,default:!1},fixed:{type:Boolean,default:!1},cursorSpacing:{type:Number,default:0},cursor:{type:[String,Number],default:""},showConfirmBar:{type:Boolean,default:!0},selectionStart:{type:Number,default:-1},selectionEnd:{type:Number,default:-1},adjustPosition:{type:Boolean,default:!0},disableDefaultPadding:{type:Boolean,default:!1},holdKeyboard:{type:Boolean,default:!1},maxlength:{type:[String,Number],default:140},border:{type:String,default:"surround"},formatter:{type:[Function,null],default:null},ignoreCompositionEvent:{type:Boolean,default:!0},confirmHold:{type:Boolean,default:!1},textStyle:{type:[Object,String],default:()=>{}},countStyle:{type:[Object,String],default:()=>{}},...null==(a=null==(e=uni.$uv)?void 0:e.props)?void 0:a.textarea}}],data:()=>({innerValue:"",focused:!1,innerFormatter:e=>e}),created(){this.innerValue=this.modelValue},watch:{value(e){this.innerValue=e},modelValue(e){this.innerValue=e}},computed:{textareaClass(){let e=[],{border:a,disabled:t}=this;return"surround"===a&&(e=e.concat(["uv-border","uv-textarea--radius"])),"bottom"===a&&(e=e.concat(["uv-border-bottom","uv-textarea--no-radius"])),t&&e.push("uv-textarea--disabled"),e.join(" ")},textareaStyle(){return this.$uv.deepMerge({},this.$uv.addStyle(this.customStyle))},maxlen(){return this.maxlength<0?this.maxlength<0?-1:140:this.maxlength},getCount(){try{return this.innerValue.length>this.maxlen?this.maxlen:this.innerValue.length}catch(e){return 0}}},methods:{setFormatter(e){this.innerFormatter=e},onFocus(e){this.$emit("focus",e)},onBlur(e){this.$emit("blur",e),this.$uv.formValidate(this,"blur")},onLinechange(e){this.$emit("linechange",e)},onInput(e){let{value:a=""}=e.detail||{};const t=(this.formatter||this.innerFormatter)(a);this.innerValue=a,this.$nextTick((()=>{this.innerValue=t,this.valueChange()}))},valueChange(){const e=this.innerValue;this.$nextTick((()=>{this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.$uv.formValidate(this,"change")}))},onConfirm(e){this.$emit("confirm",e)},onKeyboardheightchange(e){this.$emit("keyboardheightchange",e)}}},[["render",function(e,a,f,g,y,h){const v=r,b=i,_=m;return l(),t(_,{class:p(["uv-textarea",h.textareaClass]),style:u([h.textareaStyle])},{default:o((()=>[s(v,{class:"uv-textarea__field",value:y.innerValue,style:u([{height:e.autoHeight?"auto":e.$uv.addUnit(e.height)},e.$uv.addStyle(e.textStyle)]),placeholder:e.placeholder,"placeholder-style":e.$uv.addStyle(e.placeholderStyle,"string"),"placeholder-class":e.placeholderClass,disabled:e.disabled,focus:e.focus,autoHeight:e.autoHeight,fixed:e.fixed,cursorSpacing:e.cursorSpacing,cursor:e.cursor,showConfirmBar:e.showConfirmBar,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,adjustPosition:e.adjustPosition,disableDefaultPadding:e.disableDefaultPadding,holdKeyboard:e.holdKeyboard,maxlength:h.maxlen,confirmType:e.confirmType,ignoreCompositionEvent:e.ignoreCompositionEvent,"confirm-hold":e.confirmHold,onFocus:h.onFocus,onBlur:h.onBlur,onLinechange:h.onLinechange,onInput:h.onInput,onConfirm:h.onConfirm,onKeyboardheightchange:h.onKeyboardheightchange},null,8,["value","style","placeholder","placeholder-style","placeholder-class","disabled","focus","autoHeight","fixed","cursorSpacing","cursor","showConfirmBar","selectionStart","selectionEnd","adjustPosition","disableDefaultPadding","holdKeyboard","maxlength","confirmType","ignoreCompositionEvent","confirm-hold","onFocus","onBlur","onLinechange","onInput","onConfirm","onKeyboardheightchange"]),e.count&&-1!=h.maxlen?(l(),t(b,{key:0,class:"uv-textarea__count",style:u([{"background-color":e.disabled?"transparent":"#fff"},e.$uv.addStyle(e.countStyle)])},{default:o((()=>[d(c(h.getCount)+"/"+c(h.maxlen),1)])),_:1},8,["style"])):n("",!0)])),_:1},8,["class","style"])}],["__scopeId","data-v-b56fd13a"]]),R=T({__name:"confirm-order",setup(e){const a=f(),{userinfo:n}=g(a),r=y({}),u=y([]),U=y({}),z=y(""),T=y(!1),R=y("wxpay"),M=y(),O=y(""),J=y(""),W=h((()=>u.value.reduce(((e,a)=>e+a.price*a.num),0).toFixed(2))),X=h((()=>u.value.reduce(((e,a)=>e+Number(a.freight)),0).toFixed(2))),Z=h((()=>(Number(W.value)+Number(X.value)).toFixed(2))),ee=async()=>{const e={ids:u.value.map((e=>e.id)),address_id:U.value.id,mark:z.value};console.log("购物车下单",e);const a=await N(e);console.log("shopcarCreateOrder",a),O.value=a.id,J.value=a.ordersn,M.value.open()},ae=async()=>{const e={address_id:U.value.id,id:u.value[0].id,num:r.value.num,mark:z.value,tag:r.value.tag};console.log("创建订单数据",e);const a=await P(e);console.log("createGoodsOrder",a),O.value=a.id,J.value=a.ordersn,M.value.open()},te=async e=>{const t={wxpay:1,alipay:2,sz:3,money:4};console.log("handlePayConfirm e",e,t[e.type]);const l={pay_type:t[e.type],ordersn:J.value};console.log("支付参数",l);const o=await Q(l);4==l.pay_type?(a.getUserInfo(),I("/pages_shop/pages/pay-result/pay-result",{id:O.value,pay_type:l.pay_type},!1),b.setItem("carData",[])):2==l.pay_type?(console.log("支付参数",o),await $({payType:"alipay",payInfo:o}),console.log("支付完成"),a.getUserInfo(),I("/pages_shop/pages/pay-result/pay-result",{id:O.value,pay_type:l.pay_type},!1),b.setItem("carData",[])):1==l.pay_type&&(console.log("支付参数",o),await $({payType:"wechat",payInfo:{orderInfo:o}}),console.log("支付完成"),a.getUserInfo(),I("/pages_shop/pages/pay-result/pay-result",{id:O.value,pay_type:l.pay_type},!1),b.setItem("carData",[]))};return v((e=>{if(console.log("options",e),r.value=e,1==e.is_car){const e=b.getItem("carData");console.log("carData",e),u.value=e.map((e=>({...e.goods,...e})))}else(async()=>{const e=await x({id:r.value.goods_id});console.log("商品详情",e);const a=e;a.images=e.images.split(",").map((e=>({image:S(e)}))),u.value=[{...a,tag:r.value.tag,num:r.value.num}]})(),(async()=>{const e=await A({id:r.value.address_id});console.log("getAddressDetail",e),U.value=e})();_("addressChange",(e=>{console.log("addressChange",e),U.value=e}))})),(e,a)=>{const n=C(k("uv-navbar"),q),f=F,g=i,y=m,h=C(k("uv-icon"),D),v=C(k("uv-textarea"),L),b=C(k("c-pay-popup"),Y);return l(),t(y,{class:"confirm-order-container h-100-bg-drak"},{default:o((()=>[s(n,{title:"确认订单","auto-back":"","bg-color":"#E42B28","title-style":"color: #FFFFFF;font-size:40rpx;","left-icon-color":"#FFFFFF",placeholder:"",fixed:""}),s(y,{class:"card-box address-box flex items-center",onClick:a[0]||(a[0]=e=>(console.log("handleAddressClick"),void I("/pages_shop/pages/address-list/address-list",{is_confirm_order:1})))},{default:o((()=>[s(f,{class:"icon-address",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAgCAYAAAAMq2gFAAAAAXNSR0IArs4c6QAAA1ZJREFUSEutlk1oE0EUx/9vNrHBz2IVtF0lwaa72XjQkxYrKChaUKjgwYOeVBA8qCCIVLGCB8WDCoL1XEFBQQRBQUHEHrwpaDe7idJoNq0gikIPlU32yaY2NOnuJG2dW/b95/3ezPvIEBqsgpHcIqD0MbgHgA6iVVNb2AHoPXk83FLme6uy2aLMFYUZx3R9jyf4Kog2NQoGQAnMDwSLC+2ZzJcg/SzQiLF6aSuvvMGCjjUBqJEw8ySBTqumdbd+bw1o1IiviSL2GIStc4XU6D2+qWbsMzO/VUH+SVag7cWCIf+8E+Nqh2mdn4ZVQY6h3QHRiQWdpG4zMfd1mPYT/3MFVExr2xg0/D8h05X5m3+m0ub3iQrISeuvAOz4/yBAeHy6PWPfoq+pDRuFiH5oAvK07JVveax8irhuhFuiPQLoB6FTupc5r5p2goqGfokJAzLxdFT1mkorYOUQE/VJYV6pm4qG9oyJ9oYKme+ppn0kzO7DllNbjoA14T5wlgqGPk4kE5U3q2buvSxiJ6X1Q9AVSbCD5KR1ljgpqSNWtFH+vqSSuxShvJDoHshBjAnVtJY1AhV0fQcp8Cs3cBHzcx/kAoiEidwyEgnLystgxXTXSYa4Lbm6R+QYek5eonxFHbEvSnNkaO+kU565kqP7AA7J8qSUS7vWWp9eB2kKhnadiM7KAmHPO04FQztMREMN8lCCxwNgGlQt60dlbGmaxoIGIKRBTrn9U1pHo/F4LLKkZZxArY2SXrEz8gzEpC0x0xHjpWpau6eGahPToakgAkQM7l03Yj+vgEbj8dbIklhG2t3zITEPq6a93d9a/T9qMldzwZU8z928PvP5Yw3I/+EY2kMQHZyLt/Am9QY6zOzlaXvtmyEeb40ujr0DIb4gGONlzrR6d/qvo39r1ivISSY3YZHyBsDSecEYeReT3Qkz/23m/sB3naMn90FRHstGU1AQDP5Vcrk7kc1a9fbQB+Q8imNCuF5vezYb+PYIBfkRjaW0U56gm01coRQyq+qCHBZT2lEWNBh2jf51KS7vDztJaDEEwZx050GwMgSiWK2dHdfl3UE5aTpH9cKxrq6eclQ8rE4PxlsXkwfqqyu0r5q4/6rE6exUaVHkHDN/y2XsazP7pJGfvx/3SWPuIeBZAAAAAElFTkSuQmCC",mode:""}),s(y,{class:"flex-1 px-20 address-content"},{default:o((()=>[U.value.id?(l(),t(y,{key:0,class:""},{default:o((()=>[s(y,{class:"name"},{default:o((()=>[s(g,null,{default:o((()=>[d(c(U.value.name),1)])),_:1}),s(g,{class:"ml-20"},{default:o((()=>[d(c(U.value.mobile),1)])),_:1})])),_:1}),s(y,{class:"mt-12"},{default:o((()=>[d(c(`${U.value.province}/${U.value.city}/${U.value.region}  ${U.value.address}`),1)])),_:1})])),_:1})):(l(),t(y,{key:1,class:""},{default:o((()=>[d(" 未选择地址 ")])),_:1}))])),_:1}),s(h,{name:"arrow-right",color:"#C5C5C5"})])),_:1}),s(y,{class:"card-box goods-box mt-20"},{default:o((()=>[(l(!0),B(E,null,j(u.value,((e,a)=>(l(),t(y,{class:p(["flex",{"mb-20":a<u.value.length}]),key:a},{default:o((()=>[s(f,{class:"goods-cover",src:V(S)(e.image),mode:"aspectFill"},null,8,["src"]),s(y,{class:"goods-info flex-1 pl-12"},{default:o((()=>[s(y,{class:"goods-name"},{default:o((()=>[d(c(e.name),1)])),_:2},1024),s(y,{class:"goods-sku mt-8"},{default:o((()=>[d(c(e.tag),1)])),_:2},1024),s(y,{class:"flex items-center justify-between mt-8"},{default:o((()=>[s(g,{class:"goods-price"},{default:o((()=>[d("￥"+c(e.price),1)])),_:2},1024),s(g,{class:"goods-num"},{default:o((()=>[d("x"+c(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128)),s(y,{class:"cell-group mt-20"},{default:o((()=>[s(y,{class:"cell-item"},{default:o((()=>[s(y,{class:"label"},{default:o((()=>[d(" 配送方式 ")])),_:1}),s(y,{class:"content"},{default:o((()=>[d(" 快递配送 ")])),_:1})])),_:1}),s(y,{class:"cell-item mt-36"},{default:o((()=>[s(y,{class:"label"},{default:o((()=>[d(" 买家备注 ")])),_:1}),s(y,{class:"content flex-1 pl-20"},{default:o((()=>[s(v,{modelValue:z.value,"onUpdate:modelValue":a[1]||(a[1]=e=>z.value=e),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),s(y,{class:"card-box mt-20"},{default:o((()=>[s(y,{class:"cell-group"},{default:o((()=>[s(y,{class:"cell-item"},{default:o((()=>[s(y,{class:"label"},{default:o((()=>[d(" 商品总额 ")])),_:1}),s(y,{class:"content"},{default:o((()=>[d(" ￥"+c(W.value),1)])),_:1})])),_:1}),s(y,{class:"cell-item mt-36"},{default:o((()=>[s(y,{class:"label"},{default:o((()=>[d(" 运费 ")])),_:1}),s(y,{class:"content"},{default:o((()=>[d(" ￥"+c(X.value),1)])),_:1})])),_:1})])),_:1})])),_:1}),s(y,{class:"bottom-box"},{default:o((()=>[s(y,{class:"bottom-tips flex items-center px-32 py-20",onClick:a[3]||(a[3]=e=>{T.value=!T.value})},{default:o((()=>[T.value?(l(),t(f,{key:0,class:"icon icon-32",src:K,mode:""})):(l(),t(f,{key:1,class:"icon icon-32",src:G,mode:""})),s(g,{class:"ml-10"},{default:o((()=>[d("请勾选同意"),s(g,{class:"link",onClick:a[2]||(a[2]=w((e=>V(I)("/pages_common/pages/article/article",{type:5})),["stop"]))},{default:o((()=>[d("《购物协议》")])),_:1})])),_:1})])),_:1}),s(y,{class:"bottom-content pt-20 px-32"},{default:o((()=>[s(y,{class:"flex justify-between items-center"},{default:o((()=>[s(y,{class:"total"},{default:o((()=>[d(" 合计："),s(g,{class:"price"},{default:o((()=>[d("￥"+c(Z.value),1)])),_:1})])),_:1}),s(y,{class:"submit-btn center",onClick:a[4]||(a[4]=e=>(async()=>{if(!T.value)return H("请先同意购物协议");O.value?M.value.open():1==r.value.is_car?ee():ae()})())},{default:o((()=>[d(" 提交订单 ")])),_:1})])),_:1})])),_:1})])),_:1}),s(b,{ref_key:"payRef",ref:M,price:Z.value,payType:R.value,"onUpdate:payType":a[5]||(a[5]=e=>R.value=e),onConfirm:te},null,8,["price","payType"])])),_:1})}}},[["__scopeId","data-v-467c9527"]]);export{R as default};
