import{c as t,w as e,a3 as s,a1 as a,a4 as i,a5 as n,i as o,a as l,b as u,g as d,O as p,d as c,l as r,m as h,t as f,a6 as _,n as w}from"./index-Dmu3mr1_.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=g({data:()=>({popup_show:!0,update_info:null,note:[],fileSize:0,downSize:0,downing:!1,downstatus:0}),onLoad(t){t.updata_info?(this.update_info=JSON.parse(t.updata_info),this.note=this.update_info.note.split("\n")):(plus.nativeUI.toast("参数出错"),setTimeout((()=>{a()}),500))},onBackPress(t){if("backbutton"==t.from)return!0},computed:{lengthWidth:function(){let t=this.downSize/this.fileSize*100;return t=t?t.toFixed(2):0,{width:t+"%"}},getHeight:function(){let t=0;return this.tabbar&&(t=50),{bottom:t+"px",height:"auto"}}},methods:{onUpdate(){1==this.update_info.net_check&&0==this.update_info.force?i({success:t=>{"wifi"==t.networkType?this.startUpdate():n({title:"提示",content:"当前网络非WIFI,继续更新可能会产生流量,确认要更新吗？",success:t=>{t.confirm&&this.startUpdate()}})}}):this.startUpdate()},startUpdate(){if(this.downing)return!1;this.downing=!0,/\.apk$/.test(this.update_info.now_url)||/\.wgt$/.test(this.update_info.now_url)?this.download_wgt():plus.runtime.openURL(this.update_info.now_url,(function(){plus.nativeUI.toast("打开错误")}))},download_wgt(){plus.nativeUI.showWaiting("下载更新文件...");let t=plus.downloader.createDownload(this.update_info.now_url,{method:"get"});t.addEventListener("statechanged",((t,e)=>{if(null===e);else if(200==e)switch(this.downstatus=t.state,t.state){case 3:plus.nativeUI.closeWaiting(),this.downSize=t.downloadedSize,t.totalSize&&(this.fileSize=t.totalSize);break;case 4:this.installWgt(t.filename)}else plus.nativeUI.closeWaiting(),plus.nativeUI.toast("下载出错"),this.downing=!1,this.downstatus=0})),t.start()},installWgt(t){plus.nativeUI.showWaiting("安装更新文件..."),plus.runtime.install(t,{},(function(){plus.nativeUI.closeWaiting(),plus.nativeUI.alert("更新完成,请重启APP！",(function(){plus.runtime.restart()}))}),(function(t){plus.nativeUI.closeWaiting(),plus.nativeUI.alert("安装更新文件失败["+t.code+"]："+t.message)}))},closeUpdate(){s("update_ignore",this.update_info.version),a()}}},[["render",function(s,a,i,n,g,U){const m=c,v=r,I=o,S=_;return l(),t(I,{class:"page-height"},{default:e((()=>[u(I,{class:"page-content"},{default:e((()=>[g.popup_show?(l(),t(I,{key:0,class:"wrap"},{default:e((()=>[u(I,{class:"popup-bg"},{default:e((()=>[u(I,{class:p(["popup-content",{"popup-content-show":g.popup_show}])},{default:e((()=>[u(I,{class:"update-wrap"},{default:e((()=>[u(m,{src:"/h5/static/update/img.png",class:"top-img"}),u(I,{class:"content"},{default:e((()=>[u(v,{class:"title"},{default:e((()=>[h("发现新版本V"+f(g.update_info.version),1)])),_:1}),u(I,{class:"title-sub",innerHTML:g.update_info.note},null,8,["innerHTML"]),g.downstatus<1?(l(),t(S,{key:0,class:"btn",onClick:a[0]||(a[0]=t=>U.onUpdate())},{default:e((()=>[h("立即升级")])),_:1})):(l(),t(I,{key:1,class:"sche-wrap"},{default:e((()=>[u(I,{class:"sche-bg"},{default:e((()=>[u(I,{class:"sche-bg-jindu",style:w(U.lengthWidth)},null,8,["style"])])),_:1}),u(v,{class:"down-text"},{default:e((()=>[h("下载进度:"+f((g.downSize/1024/1024).toFixed(2))+"M/"+f((g.fileSize/1024/1024).toFixed(2))+"M",1)])),_:1})])),_:1}))])),_:1})])),_:1}),g.downstatus<1&&0==g.update_info.force?(l(),t(m,{key:0,src:"/h5/static/update/close.png",class:"close-ioc",onClick:a[1]||(a[1]=t=>U.closeUpdate())})):d("",!0)])),_:1},8,["class"])])),_:1})])),_:1})):d("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-2e258c6d"]]);export{U as default};
