var t,e,s,a;import{r as o,e as i,c as n,a as l,w as r,b as u,i as c,f as d,h,F as f,j as p,n as m,g as v,l as g,m as _,t as b,p as y,aE as x,B as w,bk as k,d as S,D as C,x as X,bl as z,Q as F,a5 as T,u as Y,$,bm as j}from"./index-Dmu3mr1_.js";import{_ as D}from"./uv-navbar.CCP2bw2Z.js";import{_ as A}from"./uv-empty.8gScfTjF.js";import{_ as M}from"./uv-icon.zJBDCHES.js";import{_ as O}from"./c-number-box.B-90Vk8I.js";import{m as P,a as R}from"./mixin.qHq9NBSw.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as q}from"./icon_radio3.CadTa7NB.js";import{_ as B,a as H}from"./icon_radio.BNSrvjyW.js";import"./uv-status-bar.C2pO0b0Y.js";const N={methods:{getTouchPoint:t=>t?t.touches&&t.touches[0]?{x:t.touches[0].pageX,y:t.touches[0].pageY}:t.changedTouches&&t.changedTouches[0]?{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY}:{x:t.clientX||0,y:t.clientY||0}:{x:0,y:0},resetTouchStatus(){this.direction="",this.deltaX=0,this.deltaY=0,this.offsetX=0,this.offsetY=0},touchStart(t){this.resetTouchStatus();const e=this.getTouchPoint(t);this.startX=e.x,this.startY=e.y},touchMove(t){const e=this.getTouchPoint(t);var s,a;this.deltaX=e.x-this.startX,this.deltaY=e.y-this.startY,this.offsetX=Math.abs(this.deltaX),this.offsetY=Math.abs(this.deltaY),this.direction=this.direction||(s=this.offsetX,a=this.offsetY,s>a&&s>10?"horizontal":a>s&&a>10?"vertical":"")}}},W={props:{show:{type:Boolean,default:!1},name:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},options:{type:Array,default:()=>[]},duration:{type:[String,Number],default:300},...null==(e=null==(t=uni.$uv)?void 0:t.props)?void 0:e.swipeActionItem}};function E(t){return t.toString().indexOf("s")>=0?t:t>30?t+"ms":t+"s"}function Q(t,e,s){e.getState(),s.selectAllComponents(".uv-swipe-action-item__right__button"),e.requestAnimationFrame((function(){e.setStyle({transition:"none",transform:"translateX("+t+"px)","-webkit-transform":"translateX("+t+"px)"})}))}function G(t,e){var s=t.getState();e.selectAllComponents(".uv-swipe-action-item__right__button");var a=E(s.duration),o=-s.buttonsWidth;t.requestAnimationFrame((function(){t.setStyle({transition:"transform "+a,transform:"translateX("+o+"px)","-webkit-transform":"translateX("+o+"px)"})})),L("open",t,e)}function L(t,e,s){e.getState().status=t,s.callMethod("setState",t)}function U(t,e){var s=t.getState(),a=e.selectAllComponents(".uv-swipe-action-item__right__button"),o=a.length,i=E(s.duration);t.requestAnimationFrame((function(){t.setStyle({transition:"transform "+i,transform:"translateX(0px)","-webkit-transform":"translateX(0px)"});for(var e=o-1;e>=0;e--)a[e].setStyle({transition:"transform "+i,transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})})),L("close",t,e)}const Z={touchstart:function(t,e){var s=t.instance.getState();if(!s.disabled){var a=t.touches;a&&a.length>1||(s.moving=!0,s.startX=a[0].pageX,s.startY=a[0].pageY,e.callMethod("closeOther"))}},touchmove:function(t,e){var s=t.instance,a=s.getState();if(!a.disabled&&a.moving){var o=t.touches,i=o[0].pageX,n=o[0].pageY,l=i-a.startX,r=n-a.startY,u=a.buttonsWidth;(Math.abs(l)>Math.abs(r)||Math.abs(l)>a.threshold)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),Math.abs(l)<Math.abs(r)||("open"===a.status?(l<0&&(l=0),l>u&&(l=u),Q(-u+l,s,e)):(l>0&&(l=0),Math.abs(l)>u&&(l=-u),Q(l,s,e)))}},touchend:function(t,e){var s=t.instance,a=s.getState();if(a.moving&&!a.disabled){var o=t.changedTouches?t.changedTouches[0]:{},i=o.pageX;o.pageY;var n=i-a.startX;if("open"===a.status){if(n<0)return;if(0===n)return U(s,e);Math.abs(n)<a.threshold?G(s,e):U(s,e)}else{if(n>0)return;Math.abs(n)<a.threshold?U(s,e):G(s,e)}}},sizeChange:function(t,e,s,a){var o=a.getState();if(o.disabled=t.disabled,o.duration=t.duration,o.show=t.show,o.threshold=t.threshold,o.buttons=t.buttons,o.buttons)for(var i=o.buttons.length,n=0,l=t.buttons,r=0;r<i;r++)n+=l[r].width;o.buttonsWidth=n},statusChange:function(t,e,s,a){var o=a.getState();o.disabled||("close"===t&&"open"===o.status?U(a,s):"open"===t&&"close"===o.status&&G(a,s))}},J=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("wxs"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxs=Z}})},K={name:"uv-swipe-action-item",emits:["click"],mixins:[P,R,W,N],mixins:[P,R,W,N,{methods:{closeHandler(){this.status="close"},setState(t){this.status=t},closeOther(){this.parent&&this.parent.closeOther(this)}}}],data:()=>({size:{},parentData:{autoClose:!0},status:"close"}),watch:{wxsInit(t,e){this.queryRect()}},computed:{wxsInit(){return[this.disabled,this.autoClose,this.threshold,this.options,this.duration]}},mounted(){this.init()},methods:{init(){this.updateParentData(),this.$uv.sleep().then((()=>{this.queryRect()}))},updateParentData(){this.getParentData("uv-swipe-action")},queryRect(){this.$uvGetRect(".uv-swipe-action-item__right__button",!0).then((t=>{this.size={buttons:t,show:this.show,disabled:this.disabled,threshold:this.threshold,duration:this.duration}}))},buttonClickHandler(t,e){this.$emit("click",{index:e,name:this.name})}}};J(K);const V=I(K,[["render",function(t,e,s,a,y,x){const w=o(i("uv-icon"),M),k=g,S=c;return l(),n(S,{class:"uv-swipe-action-item",ref:"uv-swipe-action-item"},{default:r((()=>[u(S,{class:"uv-swipe-action-item__right"},{default:r((()=>[d(t.$slots,"button",{},(()=>[(l(!0),h(f,null,p(t.options,((e,s)=>(l(),n(S,{key:s,class:"uv-swipe-action-item__right__button",ref_for:!0,ref:`uv-swipe-action-item__right__button-${s}`,style:m([{alignItems:e.style&&e.style.borderRadius?"center":"stretch"}]),onClick:t=>x.buttonClickHandler(e,s)},{default:r((()=>[u(S,{class:"uv-swipe-action-item__right__button__wrapper",style:m([{backgroundColor:e.style&&e.style.backgroundColor?e.style.backgroundColor:"#C7C6CD",borderRadius:e.style&&e.style.borderRadius?e.style.borderRadius:"0",padding:e.style&&e.style.borderRadius?"0":"0 15px"},e.style])},{default:r((()=>[e.icon?(l(),n(w,{key:0,name:e.icon,color:e.style&&e.style.color?e.style.color:"#ffffff",size:e.iconSize?t.$uv.addUnit(e.iconSize):e.style&&e.style.fontSize?1.2*t.$uv.getPx(e.style.fontSize):17,customStyle:{marginRight:e.text?"2px":0}},null,8,["name","color","size","customStyle"])):v("",!0),e.text?(l(),n(k,{key:1,class:"uv-swipe-action-item__right__button__wrapper__text uv-line-1",style:m([{color:e.style&&e.style.color?e.style.color:"#ffffff",fontSize:e.style&&e.style.fontSize?e.style.fontSize:"16px",lineHeight:e.style&&e.style.fontSize?e.style.fontSize:"16px"}])},{default:r((()=>[_(b(e.text),1)])),_:2},1032,["style"])):v("",!0)])),_:2},1032,["style"])])),_:2},1032,["style","onClick"])))),128))]),!0)])),_:3}),u(S,{class:"uv-swipe-action-item__content",onTouchstart:t.wxs.touchstart,onTouchmove:t.wxs.touchmove,onTouchend:t.wxs.touchend,status:y.status,"change:status":t.wxs.statusChange,size:y.size,"change:size":t.wxs.sizeChange},{default:r((()=>[d(t.$slots,"default",{},void 0,!0)])),_:3},8,["onTouchstart","onTouchmove","onTouchend","status","change:status","size","change:size"])])),_:3},512)}],["__scopeId","data-v-6b3a1ae1"]]);const tt=I({name:"uv-swipe-action",mixins:[P,R,{props:{autoClose:{type:Boolean,default:!0},...null==(a=null==(s=uni.$uv)?void 0:s.props)?void 0:a.swipeAction}}],data:()=>({}),provide(){return{swipeAction:this}},computed:{parentData(){return[this.autoClose]}},watch:{parentData(){this.children.length&&this.children.map((t=>{"function"==typeof t.updateParentData&&t.updateParentData()}))}},created(){this.children=[]},methods:{closeOther(t){this.autoClose&&this.children.map(((e,s)=>{t!==e&&e.closeHandler()}))}}},[["render",function(t,e,s,a,o,i){const u=c;return l(),n(u,{class:"uv-swipe-action"},{default:r((()=>[d(t.$slots,"default")])),_:3})}]]),et=I({__name:"car",setup(t){const e=y([]),s=y([]),a=y([{text:"删除",style:{backgroundColor:"#FF4D55"}}]),d=x((()=>s.value.length==e.value.length&&e.value.length>0)),m=x((()=>(e.value.filter((t=>-1!=s.value.indexOf(t.id)))||[]).reduce(((t,e)=>t+e.goods.price*e.num+Number(e.goods.freight)),0).toFixed(2))),P=t=>{console.log("handleItemOptClick e",t);const s=e.value.find((e=>e.id==t.name));console.log("需要操作的商品",s),0==t.index&&(console.log("删除"),R([s.id]))},R=async(t=[])=>{await j({ids:t}),s.value=s.value.filter((e=>-1==t.indexOf(e))),e.value=e.value.filter((e=>-1==t.indexOf(e.id)))};return w((()=>{(async()=>{const t=await k();console.log("getShopcarList",t),e.value=t})()})),(t,y)=>{const x=o(i("uv-navbar"),D),w=o(i("uv-empty"),A),k=c,j=S,I=o(i("uv-icon"),M),N=g,W=o(i("c-number-box"),O),E=o(i("uv-swipe-action-item"),V),Q=o(i("uv-swipe-action"),tt);return l(),n(k,{class:"h-100-bg-drak"},{default:r((()=>[u(x,{title:"购物车",fixed:"","auto-back":"","bg-color":"#E42B28","title-style":"color: #FFFFFF;","left-icon-color":"#FFFFFF",placeholder:""}),u(k,{class:"py-30 px-32 car-content"},{default:r((()=>[0===e.value.length?(l(),n(k,{key:0,class:"pt-100"},{default:r((()=>[u(w,{mode:"data"})])),_:1})):v("",!0),u(Q,null,{default:r((()=>[(l(!0),h(f,null,p(e.value,((t,o)=>(l(),n(k,{class:"mb-20 car-goods-item-box",key:o},{default:r((()=>[u(E,{options:a.value,name:t.id,onClick:P},{default:r((()=>[u(k,{class:"car-goods-item flex items-center"},{default:r((()=>[u(k,{class:"icon-radio",onClick:e=>(t=>{-1!=s.value.indexOf(t.id)?s.value=s.value.filter((e=>e!=t.id)):s.value.push(t.id)})(t)},{default:r((()=>[-1!=s.value.indexOf(t.id)?(l(),n(j,{key:0,class:"icon-40",src:"/h5/static/icons/icon_radio3_check.png",mode:""})):(l(),n(j,{key:1,class:"icon-40",src:q,mode:""}))])),_:2},1032,["onClick"]),u(k,{class:"flex-1 pl-20 flex"},{default:r((()=>[u(j,{class:"goods-cover",src:C(X)(t.goods.image),mode:"aspectFill"},null,8,["src"]),u(k,{class:"flex-1 pl-20"},{default:r((()=>[u(k,{class:"goods-name text_ovf2"},{default:r((()=>[_(b(t.goods.name),1)])),_:2},1024),u(k,{class:"goods-sku mt-4 center"},{default:r((()=>[_(b(t.tag)+" ",1),u(I,{name:"arrow-right",size:"10",color:"#6A6A6A"})])),_:2},1024),u(k,{class:"mt-20 flex items-center justify-between"},{default:r((()=>[u(k,{class:"goods-price"},{default:r((()=>[u(N,null,{default:r((()=>[_("￥"+b(t.goods.price),1)])),_:2},1024),u(N,{class:"old-price ml-20"},{default:r((()=>[_("￥"+b(t.goods.original_price),1)])),_:2},1024)])),_:2},1024),u(k,{class:""},{default:r((()=>[u(W,{value:t.num,onInput:t=>(async(t,s)=>{console.log("e",t),await z({id:e.value[s].id,num:t}),e.value[s].num=t})(t,o)},null,8,["value","onInput"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["options","name"])])),_:2},1024)))),128))])),_:1})])),_:1}),u(k,{class:"bottom-box"},{default:r((()=>[u(k,{class:"flex-1 mr-54 flex items-center justify-between"},{default:r((()=>[u(k,{class:"flex items-center check-box"},{default:r((()=>[d.value?(l(),n(j,{key:0,class:"icon-radio",src:B,mode:"scaleToFill"})):(l(),n(j,{key:1,class:"icon-radio",src:H,mode:"scaleToFill"})),u(N,{class:"ml-24",onClick:y[0]||(y[0]=t=>{d.value?s.value=[]:s.value=e.value.map((t=>t.id))})},{default:r((()=>[_(b(d.value?"取消全选":"全选"),1)])),_:1}),u(N,{class:"ml-24 del-text",onClick:y[1]||(y[1]=t=>(()=>{if(0==s.value.length)return F("请选择要删除的商品");T({content:"确认要删除吗?",success:t=>{t.confirm&&R(s.value)}})})())},{default:r((()=>[_("删除")])),_:1})])),_:1}),u(k,{class:"total-price"},{default:r((()=>[_(" 合计："),u(N,{class:"total-price-text"},{default:r((()=>[_("￥"+b(m.value),1)])),_:1})])),_:1})])),_:1}),u(k,{class:"submit-btn",onClick:y[2]||(y[2]=t=>(()=>{if(0==s.value.length)return F("请选择要结算的商品");const t=e.value.filter((t=>-1!=s.value.indexOf(t.id)));console.log("需要购买的数据",t),Y.setItem("carData",t),$("/pages_shop/pages/confirm-order/confirm-order",{is_car:1})})())},{default:r((()=>[_(" 去结算 ")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a845fbd5"]]);export{et as default};
