var e,t;import{r as a,e as s,c as l,a as o,w as i,b as n,i as c,E as d,h as u,F as r,j as g,O as h,g as m,n as v,p as A,L as f,M as I,o as p,bD as C,d as E,D as B,x as _,m as x,t as w,bA as b,H as Q,as as y,Q as D,Y as O,bG as U,T as V,a8 as j}from"./index-Dmu3mr1_.js";import{_ as k}from"./uv-navbar.CCP2bw2Z.js";import{_ as N}from"./uv-icon.zJBDCHES.js";import{m as R,a as F}from"./mixin.qHq9NBSw.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as T}from"./uv-switch.D31Up2N4.js";import{_ as S}from"./uv-button.CRA7t01f.js";import{_ as z}from"./icon_search_close.B8tPxAGe.js";import{u as H}from"./common.knSLbAE6.js";import"./uv-status-bar.C2pO0b0Y.js";import"./uv-loading-icon.BL07fx-H.js";const L=M({name:"uv-rate",mixins:[R,F,{props:{value:{type:[String,Number],default:0},modelValue:{type:[String,Number],default:0},count:{type:[String,Number],default:5},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},size:{type:[String,Number],default:18},inactiveColor:{type:String,default:"#b2b2b2"},activeColor:{type:String,default:"#FA3534"},gutter:{type:[String,Number],default:4},minCount:{type:[String,Number],default:1},allowHalf:{type:Boolean,default:!1},activeIcon:{type:String,default:"star-fill"},inactiveIcon:{type:String,default:"star"},touchable:{type:Boolean,default:!1},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.rate}}],data:()=>({elId:"",elClass:"",rateBoxLeft:0,activeIndex:0,rateWidth:0,moving:!1}),watch:{value(e){this.activeIndex=e},modelValue(e){this.activeIndex=e}},created(){this.activeIndex=Number(this.value||this.modelValue),this.elId=this.$uv.guid(),this.elClass=this.$uv.guid()},mounted(){this.init()},methods:{init(){this.$uv.sleep(200).then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await this.$uv.sleep(),this.$uvGetRect("#"+this.elId).then((e=>{this.rateBoxLeft=e.left}))},getRateIconWrapRect(){this.$uvGetRect("."+this.elClass).then((e=>{this.rateWidth=e.width}))},touchMove(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches&&e.changedTouches[0].pageX||e.detail&&e.detail.pageX;this.getActiveIndex(t)},touchEnd(e){if(!this.touchable)return;this.preventEvent(e);const t=e.changedTouches&&e.changedTouches[0].pageX||e.detail&&e.detail.pageX;this.getActiveIndex(t)},clickHandler(e,t){if("ios"===this.$uv.os()&&this.moving)return;this.preventEvent(e);let a=0;a=e.changedTouches&&e.changedTouches[0].pageX||e.detail&&e.detail.pageX,this.getActiveIndex(a,!0)},changeEvent(){this.$emit("change",this.activeIndex),this.$emit("input",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(e,t=!1){if(this.disabled||this.readonly)return;const a=this.rateWidth*this.count+this.rateBoxLeft,s=e=this.$uv.range(this.rateBoxLeft,a,e)-this.rateBoxLeft;let l;if(this.allowHalf){l=Math.floor(s/this.rateWidth);const e=s%this.rateWidth;e<=this.rateWidth/2&&e>0?l+=.5:e>this.rateWidth/2&&l++}else{l=Math.floor(s/this.rateWidth);const e=s%this.rateWidth;t?e>0&&l++:e>this.rateWidth/2&&l++}this.activeIndex=Math.min(l,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),this.changeEvent(),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}}},[["render",function(e,t,A,f,I,p){const C=a(s("uv-icon"),N),E=c;return o(),l(E,{class:"uv-rate",id:I.elId,ref:"uv-rate",style:v([e.$uv.addStyle(e.customStyle)])},{default:i((()=>[n(E,{class:"uv-rate__content",onTouchmove:d(p.touchMove,["stop"]),onTouchend:d(p.touchEnd,["stop"])},{default:i((()=>[(o(!0),u(r,null,g(Number(e.count),((t,a)=>(o(),l(E,{class:h(["uv-rate__content__item",[I.elClass]]),key:a},{default:i((()=>[n(E,{class:"uv-rate__content__item__icon-wrap",ref_for:!0,ref:"uv-rate__content__item__icon-wrap",onClick:d((e=>p.clickHandler(e,a+1)),["stop"])},{default:i((()=>[n(C,{name:Math.floor(I.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.floor(I.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{"padding-left":e.$uv.addUnit(e.gutter/2),"padding-right":e.$uv.addUnit(e.gutter/2)},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick"]),e.allowHalf?(o(),l(E,{key:0,onClick:d((e=>p.clickHandler(e,a+1)),["stop"]),class:"uv-rate__content__item__icon-wrap uv-rate__content__item__icon-wrap--half",style:v([{width:e.$uv.addUnit(I.rateWidth/2)}]),ref_for:!0,ref:"uv-rate__content__item__icon-wrap"},{default:i((()=>[n(C,{name:Math.ceil(I.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.ceil(I.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{"padding-left":e.$uv.addUnit(e.gutter/2),"padding-right":e.$uv.addUnit(e.gutter/2)},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick","style"])):m("",!0)])),_:2},1032,["class"])))),128))])),_:1},8,["onTouchmove","onTouchend"])])),_:1},8,["id","style"])}],["__scopeId","data-v-64097c7a"]]),J=M({__name:"order-comments",setup(e){const t=A(""),d=A({}),h=A([]),v=A({goods:{}}),N=f({id:"",score:5,images:"",content:"",anonymity:1}),R=A([]);I((()=>{N.images=R.value.join(",")}));const F=()=>{console.log("上传"),y({count:9-R.value.length,success:async e=>{try{const t=e.tempFilePaths,a=e.tempFiles;console.log("需要上传的临时地址",t,a);let s=[];for(let e=0;e<t.length;e++){const a=t[e],l=await H(a);s.push(l.data.url)}D("上传成功"),R.value=R.value.concat(s)}catch(t){console.log("e",t),O()}}})};return p((e=>{console.log("options",e),t.value=e.orderId,(async()=>{var e;const a=await C({id:t.value});console.log("getOrderDetail",a),d.value=a,h.value=null==(e=a.subs)?void 0:e.filter((e=>!e.comment)),console.log("goodsList.value",h.value)})()})),(e,t)=>{const d=a(s("uv-navbar"),k),A=E,f=c,I=a(s("uv-rate"),L),p=b,C=a(s("uv-switch"),T),y=a(s("uv-button"),S);return o(),l(f,{class:"h-100-bg-drak"},{default:i((()=>[n(d,{title:"发表评价","auto-back":"","bg-color":"#E42B28","title-style":"color: #FFFFFF;font-size:40rpx;","left-icon-color":"#FFFFFF",placeholder:"",fixed:""}),n(f,{class:"px-32 py-22"},{default:i((()=>[N.id?(o(),u(r,{key:1},[n(f,{class:"goods-info-box flex"},{default:i((()=>[n(A,{class:"goods-image",src:B(_)(v.value.goods.image),mode:"aspectFill"},null,8,["src"]),n(f,{class:"flex-1 flex flex-column justify-between pl-20"},{default:i((()=>[n(f,{class:"goods-name"},{default:i((()=>[x(w(v.value.goods.name),1)])),_:1}),n(f,{class:"goods-sku"},{default:i((()=>[x(w(v.value.tag),1)])),_:1}),n(f,{class:"flex items-center justify-between"},{default:i((()=>[n(f,{class:"goods-price"},{default:i((()=>[x(" ￥"+w(v.value.amount),1)])),_:1}),n(f,{class:"goods-num"},{default:i((()=>[x(" x"+w(v.value.num),1)])),_:1})])),_:1})])),_:1})])),_:1}),n(f,{class:"goods-comments-images mt-20"},{default:i((()=>[n(f,{class:"flex flex-wrap"},{default:i((()=>[(o(!0),u(r,null,g(R.value,((e,t)=>(o(),l(f,{class:"goods-comments-image mr-20 mb-20",key:t},{default:i((()=>[n(A,{class:"goods-comments-image",src:B(_)(e),mode:"",onClick:e=>(e=>{console.log("预览");const t=R.value.map((e=>_(e)));Q({urls:t,current:e})})(t)},null,8,["src","onClick"]),n(A,{class:"icon-close",src:z,mode:"",onClick:e=>(e=>{console.log("删除"),R.value=R.value.filter(((t,a)=>a!=e))})(t)},null,8,["onClick"])])),_:2},1024)))),128)),R.value.length<9?(o(),l(A,{key:0,class:"goods-comments-image mr-20",src:"data:image/png;base64,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",mode:"",onClick:F})):m("",!0)])),_:1}),n(f,{class:"tips mt-8"},{default:i((()=>[x(" 最多可传9张 ")])),_:1})])),_:1}),n(f,{class:"p-30 rate-and-comments-box mt-20"},{default:i((()=>[n(f,{class:"flex pb-24 border-b"},{default:i((()=>[n(f,{class:"rate-title"},{default:i((()=>[x(" 综合评分： ")])),_:1}),n(f,{class:""},{default:i((()=>[n(I,{modelValue:N.score,"onUpdate:modelValue":t[0]||(t[0]=e=>N.score=e)},null,8,["modelValue"])])),_:1})])),_:1}),n(f,{class:"pt-20"},{default:i((()=>[n(p,{modelValue:N.content,"onUpdate:modelValue":t[1]||(t[1]=e=>N.content=e),class:"textarea",placeholder:"请客观真实地描述物品及交易体验，不超过200个字",maxlength:"200"},null,8,["modelValue"])])),_:1})])),_:1}),n(f,{class:"is-nm mt-20 flex items-center justify-between"},{default:i((()=>[n(f,{class:""},{default:i((()=>[x(" 是否匿名 ")])),_:1}),n(f,{class:""},{default:i((()=>[n(C,{modelValue:N.anonymity,"onUpdate:modelValue":t[2]||(t[2]=e=>N.anonymity=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1}),n(f,{class:"mt-100 pb-100"},{default:i((()=>[n(y,{shape:"circle",text:"提交",color:"#E42B28",onClick:t[3]||(t[3]=e=>(async()=>{console.log("handleSubmit",N);try{await U(N),D("评价成功"),V("orderRefresh"),setTimeout((()=>{j()}),800)}catch(e){console.error("提交评价失败",e)}})())})])),_:1})],64)):(o(),l(f,{key:0,class:"goods-list"},{default:i((()=>[(o(!0),u(r,null,g(h.value,((e,t)=>(o(),l(f,{class:"goods-list-item flex mb-20",key:t},{default:i((()=>[n(A,{class:"goods-image",src:B(_)(e.goods.image),mode:"aspectFill"},null,8,["src"]),n(f,{class:"flex-1 flex flex-column justify-between pl-20"},{default:i((()=>[n(f,{class:"goods-name"},{default:i((()=>[x(w(e.goods.name),1)])),_:2},1024),n(f,{class:"goods-sku"},{default:i((()=>[x(w(e.tag),1)])),_:2},1024),n(f,{class:"flex justify-end"},{default:i((()=>[n(f,{class:"goods-comments-btn center",onClick:t=>(e=>{console.log("handleGoodsCommentClick",e),N.id=e.id,v.value=e})(e)},{default:i((()=>[x(" 去评价 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-232eefe7"]]);export{J as default};
